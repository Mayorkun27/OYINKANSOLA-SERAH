<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <!-- Bootstrap -->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
     <!-- Icon -->
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
     <link rel="stylesheet" href="dashboard.css">
     <title>Dashboard</title>
</head>
<body>

     <div class="tabbles">
          <table class="table">
               <thead>
                    <tr>
                         <th scope="col">Fullname</th>
                         <th scope="col">Email</th>
                         <th scope="col">Date of Birth</th>
                    </tr>
               </thead>
               <tbody class="datalist">
                    
               </tbody>
          </table>
     </div>
     
     

     <!-- Font Awsome Link -->
     <script src="https://kit.fontawesome.com/2a49fbdbb8.js" crossorigin="anonymous"></script>
     <!-- Bootstrap Js -->
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
     <!-- Swiper Js -->
     <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-element-bundle.min.js"></script>
     <!-- Lottiefiles Js -->
     <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
     <!-- Graph Js -->
     <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
     <script src="graph.js"></script>
     <!-- AXIOS JS -->
     <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
     <!-- Dashboard JS -->
     <script src="cal.js"></script>
     <script src="dashboard.js"></script>
     <script>
          document.addEventListener("DOMContentLoaded", async function() {
              console.log("hello world");
          
              try {
                  const apiUrl = '/api/v1/auth/user';
                  const token = localStorage.getItem("token");
                  console.log("Retrieved Token: ", token);
          
                  if (!token || token.split('.').length !== 3) {
                      console.error("Invalid Token Format");
                      // Handle invalid token (e.g., redirect to login page)
                  } else {
                      fetch(apiUrl, {
                          method: 'GET',
                          headers: {
                              'Authorization': `Bearer ${token}`,
                              'Content-Type': 'application/json'
                          }
                      })
                      .then(response => {
                          if (!response.ok) {
                              throw new Error('Network response was not ok');
                          }
                          return response.json();
                      })
                      .then(data => {
                          console.log(data);
                          // Handle the fetched user data
                          const userName = data.user.name;
                          document.querySelector(".profileName").innerHTML = `${userName}`;
          
                          const email = data.user.email;
                          document.querySelector(".profileEmail").innerHTML = `${email}`;
          
                          const userRole = data.user.role;
                          console.log(userRole);
                          const isAdminDashboard = userRole === 1 && window.location.pathname === '/dashboard.html';
                          if (isAdminDashboard) return;
                          const nextPage = userRole === 1 ? 'dashboard.html' : 'products.html';
                          window.location.href = nextPage;
                      })
                      .catch(error => {
                          console.error('Fetch error:', error);
                      });
                  }
              } catch (error) {
                  console.log(error.message);
              }       
          });
     </script>
          
      <!-- Lazy Loader -->
      <script>
          function delay(milliseconds) {
              return new Promise((resolve) => setTimeout(resolve, milliseconds));
          }
          document.addEventListener('DOMContentLoaded', function(){
              async function showContent() {
                  content.classList.remove('hidden');
                  await delay(1000);
              }
  
              async function initializeWebsite() {
                  document.getElementById('loader').style.display = 'flex';
                  await delay(1000);
                  document.getElementById('loader').style.display = 'none';
                  await showContent();
              }
  
              window.addEventListener("load", initializeWebsite);
          })
      </script>
</body>
</html>