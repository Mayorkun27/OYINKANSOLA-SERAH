<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <!-- Bootstrap -->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
     <link rel="stylesheet" href="../offlines/bootstrap.min.css">
     <!-- Icon -->
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
     <link rel="stylesheet" href="../offlines/fontawesome-free-6.4.2-web/css/all.css">
     <link rel="stylesheet" href="../offlines/tabler-icons/webfont/tabler-icons.min.css">

     <link rel="stylesheet" href="../student/dashboard.css">
     <link rel="stylesheet" href="../responsiveness.css">
     <link rel="stylesheet" href="../styles.css">
     <link rel="stylesheet" href="loading.css">
     <title>Admin Dashboard</title>
</head>
<body style="position: relative;"  class="collapsd general">
     <!-- Loading display -->
     <div id="loading" class="loading">
          <div class="loader">
               <div class="box1"></div>
               <div class="box2"></div>
               <div class="box3"></div>
          </div>
     </div>

     <main  id="content" class="hidden row">
        
          <div class="col-2 p-0" id="side">
               <nav class="sidebar">
                    <div class="sidebar-top-wrapper">
                         <div class="sidebar-top mx-auto">
                              <a href="#" class="logo_wrapper">
                                   <img src="../images/multiple.png" alt="logo" class="logo-small logo-small1">
                                   <img src="../images/single.png" alt="logo" class="logo-small logo-small2">
                              </a>
                         </div>
                         <button class="expand-btn" type="button"><i class="fa fa-expand"></i></button>
                    </div>
                    <div class="sidebar-links-wrapper">
                         <div class="sidebar-links">
                              <ul>
                                   <li>
                                        <a href="adminindex.html" class="main-item active" title="Dashboard">
                                             <i class="fa-solid fa-tachograph-digital"></i>
                                             <span class="link hide">Overview</span>
                                        </a>
                                   </li>
                                   <li>
                                        <a href="allStudents.html" title="Profile" class="main-item">
                                             <i class="fa-solid fa-building-columns"></i>
                                             <span class="link hide">All Students</span>
                                        </a>
                                   </li>
                                   <li>
                                        <a href="CreateFaculty.html" title="Create Faculty" class="main-item">
                                             <i class="fa fa-clipboard"></i>
                                             <span class="link hide">Create Faculty</span>
                                        </a>
                                   </li>
                                   <li>
                                        <a href="#" title="Lorem" class="main-item">
                                             <i class="fa fa-exchange"></i>
                                             <span class="link hide">Lorem</span>
                                        </a>
                                   </li>
                              </ul>
                         </div>
                    </div>
                    <div class="sidebar_bottom">
                         <div class="sidebar_profile">
                              <div class="avatar_wrapper">
                                   <img src="../images/img1.webp" alt="avatar" class="avatar bg-light">
                              </div>
                              <div class="avatar_name hide">
                                   <div class="user-name">Administrator</div>
                                   <div class="email">admin@mail.com</div>
                              </div>
                         </div>
                         <!-- Logout icon -->
                         <a title="Logout" class="logout tooltips main-item" onclick="logout()">
                              <i class="fa fa-sign-out-alt"></i>
                              <span class="expand-icon">Logout</span>
                         </a>
                    </div>
               </nav>
           </div>
   
          <div class="col-10 p-0" id="main">
               <section class="main-content ms-auto pb-5">

                    <div class="col-12">
                         <div class="in-new-prod-cont p-3">
                              <h4 class="p-0 m-0">Overview</h4>
                         </div>
                    </div>

                    <div class="row adminoverview mt-4">
                         <div class="col-lg-4 col-md-4 col-6">
                              <div class="card p-3">
                                   <div class="top">
                                        <p>Total Enrolled Stuents</p>
                                        <h3 class="fw-bold totalStudent">5.5M+</h3>
                                   </div>
                                   <i class="fa fa-user-graduate"></i>
                              </div>
                         </div>
                         <div class="col-lg-4 col-md-4 col-6">
                              <div class="card p-3">
                                   <div class="top">
                                        <p>Received Tution Fee</p>
                                        <h3 class="fw-bold"><span class="totalSchoolFees">13.8B+</span><div style="margin-left: 2rem; float: right; font-size: 1rem;">(<span class="totalStudentFees">200</span> students)</div></h3>
                                   </div>
                                   <i class="fa fa-bank"></i>
                              </div>
                         </div>
                         <div class="col-lg-4 col-md-4 col-6">
                              <div class="card p-3">
                                   <div class="top">
                                        <p>Expeled Students</p>
                                        <h3 class="fw-bold"><span class="totalExpeledStudents">5</span></h3>
                                   </div>
                                   <i class="fa fa-user-slash"></i>
                              </div>
                         </div>
                    </div>
                    
                    <div class="mt-4 table-responsive">
                         <table class="table">
                              <thead>
                                   <tr>
                                        <th scope="col">Profile</th>
                                        <th scope="col">Fullname</th>
                                        <th scope="col">Email</th>
                                        <th scope="col">Matric Number</th>
                                        <th scope="col">Faculty</th>
                                        <th scope="col">Admission Type</th>
                                        <th scope="col">Date of Birth</th>
                                        <th scope="col">Year of Admission</th>
                                   </tr>
                              </thead>
                              <tbody class="datalist">
                                   
                              </tbody>
                         </table>
                    </div>

                    
               </section>
          </div>
          
     </main>
     <script src="loading.js"></script>
     <script src="../student/sidebar.js"></script>
     <script src="../student/dashboard.js"></script>
      <!-- Font Awsome Link -->
      <script src="https://kit.fontawesome.com/2a49fbdbb8.js" crossorigin="anonymous"></script>
      <!-- Bootstrap Js -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
      <script src="../bootstrap-5.3.3-dist/js/bootstrap.bundle.min.js"></script>
      <!-- AXIOS JS -->
      <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
      <script>
          let apiUrl = "/api/v1/auth/users";
          let datalist = document.querySelector('.datalist');
          document.addEventListener('DOMContentLoaded', function() {
               // Total student and last 5
               axios.get(apiUrl)
               .then((response) => {
                    let data = response.data;
                    console.log(data)
                    let totalStudent = document.querySelector('.totalStudent');
                    totalStudent.innerHTML = data.length;
                    data.forEach(student => {
                         let row = document.createElement('tr');
                         row.innerHTML = `
                              <td><img src="${student.photo}" width="50px" height="50px"></td>
                              <td>${student.firstName} ${student.lastName}</td>
                              <td>${student.email}</td>
                              <td>${student.matricNumber}</td>
                              <td>${student.studyType}</td>
                              <td>${student.programType}</td>
                              <td>${new Date(student.birthDate).toLocaleDateString()}</td>
                              <td>${student.admissionYear}</td>
                         `;
                         row.addEventListener('click', () => showStudentDetails(student));
                         datalist.appendChild(row);
                         // show only the recent 5 students
                         if (datalist.children.length > 5) {
                              datalist.removeChild(datalist.children[0]);
                         }
                    });
               })
               .catch((error) => {
                    console.log(error);
               });
               // Numbers of Expeled Students
               axios.get('/api/v1/auth/deletedUsers')
               .then((response) => {
                    let data = response.data.users;
                    console.log(data)
                    let totalExpeledStudents = document.querySelector('.totalExpeledStudents');
                    totalExpeledStudents.innerHTML = data.length;
               })
               .catch((error) => {
                    console.log(error);
               });
               // School Fees
               axios.get("/api/v1/transaction/getAll")
               .then((response) => {
                    let data = response.data.transactions;
                    let totalStudentFees = document.querySelector('.totalStudentFees');
                    totalStudentFees.innerHTML = data.length;

                    // Calculate the total amount of school fees paid
                    let totalSchoolFees = data.reduce((acc, transaction) => {
                         return acc + transaction.transAmt;
                    }, 0);

                    // Format the total school fees
                    let formattedTotalSchoolFees = abbreviateNumber(totalSchoolFees);

                    // Display the total school fees paid
                    let totalSchoolFeesElement = document.querySelector('.totalSchoolFees');
                    totalSchoolFeesElement.innerHTML = `${formattedTotalSchoolFees}+  `;
               })
               .catch((error) => {
                    console.log(error);
               });

               // Function to abbreviate number
               function abbreviateNumber(value) {
                    let newValue = value;
                    const suffixes = ["", "K", "M", "B", "T"];
                    let suffixNum = 0;
                    while (newValue >= 1000) {
                         newValue /= 1000;
                         suffixNum++;
                    }
                    newValue = newValue.toPrecision(3);
                    newValue += suffixes[suffixNum];
                    return newValue;
               }

                
          });

     </script>
 </body>
 </html>