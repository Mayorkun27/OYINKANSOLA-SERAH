<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <!-- Bootstrap -->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
     <!-- Icon -->
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
     <title>All Students</title>
     <style>
          .FilterBar{
               display: none;
               position: fixed;
               top: 0;
               left: 0;
               width: 100%;
               height: 100%;
               background-color: rgba(0, 0, 0, 0.5);

               z-index: 1000;
          }
          .list-group-item{
               font-weight: 700;
               span{
                    font-weight: 300;
               }
          }
     </style>
</head>
<body>

     <!-- search bar and filter button -->
     <div class="container-fluid mt-3">
          <div class="row">
               <div class="col-md-6">
                    <div class="input-group mb-3">
                         <input type="text" class="form-control" id="inputs" placeholder="Search Student">
                         <button class="btn btn-outline-secondary" type="button" id="button-addon2"><i class="bi bi-search"></i></button>
                    </div>
               </div>
               <div class="col-md-6 ">
                    <button class="btn btn-primary refresh"><i class="fa-solid fa-arrows-rotate"></i> Refresh</button>
                    <button class="btn btn-primary filterBtn" data-bs-toggle="modal" data-bs-target="#filterModal"><i class="fa fa-filter"></i>Filter</button>
               </div>
          </div>
     </div>
     
     <!-- table -->
     <div class="tabbles">
          <table class="table">
               <thead>
                    <tr>
                         <th scope="col">Profile</th>
                         <th scope="col">Fullname</th>
                         <th scope="col">Email</th>
                         <th scope="col">Matric Number</th>
                         <th scope="col">Faculty</th>
                         <th scope="col">Admission Type</th>
                         <th scope="col">Date of Birth</th>
                         <th scope="col">Year of Admission</th>
                    </tr>
               </thead>
               <tbody class="datalist">
                    
               </tbody>
          </table>
     </div>
     
     <!-- Filter Modal -->
     <div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
          <div class="modal-dialog">
          <div class="modal-content">
               <div class="modal-header">
                    <h5 class="modal-title" id="filterModalLabel">Filter Options</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
               </div>
               <div class="modal-body">
                    <div class="mb-3">
                         <label for="facultyFilter" class="form-label">Faculty</label>
                         <select name="facultyFilter" class="px-2 form-control" id="facultyFilter">
                              <option value="" selected disabled>Select Faculty</option>
                         </select>
                    </div>
                    <div class="mb-3">
                         <label for="admissionTypeFilter" class="form-label">Admission Type</label>
                         <select name="admissionTypeFilter" class="px-2 form-control" id="admissionTypeFilter">
                              <option value="" selected disabled>Select Program Type</option>
                              <option value="UnderGraduate">UnderGraduate</option>
                              <option value="PostGraduate">PostGraduate</option>
                              <option value="PartTime">PartTime</option>
                              <option value="Open Distance Learning">Open Distance Learning</option>
                              <option value="Pre Degree Program">Pre Degree Program</option>
                              <option value="JUPEB Program">JUPEB Program</option>
                         </select>
                    </div>
                    <div class="mb-3">
                         <label for="yearFilter" class="form-label">Year of Admission</label>
                         <select id="yearFilter" class="form-select">
                              <option value="">All</option>
                              <option value="2024">2024</option>
                              <!-- Add more options as needed -->
                         </select>
                    </div>
               </div>
               <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btnClose" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="applyFilters">Apply Filters</button>
               </div>
          </div>
          </div>
     </div>

     <!-- The Modal -->
     <div class="modal fade" id="studentDetailsModal" tabindex="-1" aria-labelledby="studentDetailsModalLabel" aria-hidden="true">
          <div class="modal-dialog-scrollable modal-lg modal-dialog-centered modal-dialog">
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title" id="studentDetailsModalLabel">Student's Details</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                      <!-- PERSONAL INFORMATION -->
                      <div class="more-details mb-5">
                          <h5 class="modal-title text-danger">PERSONAL INFORMATION</h5>
                          <hr>
                          <div class="row">
                              <div class="col-lg-6">
                                  <div class="list-group list-group-flush">
                                        <div class="list-group list-group-item">Profile Picture:<br>
                                        <img src="../images/img13.png" id="studentPhoto" width="100px" height="100px">
                                        </div>
                                   </div>
                              </div>
                              <div class="col-lg-6">
                                  <div class="list-group list-group-flush">
                                      <div class="list-group-item">Fullname:<br>
                                          <span id="studentFullname"></span>
                                      </div>
                                      <div class="list-group-item">Phone Number: <br>
                                          <span id="studentPhoneNumber"></span>
                                      </div>
                                      <div class="list-group-item">Email Address: <br>
                                          <span id="studentEmailAddress"></span>
                                      </div>
                                      <div class="row">
                                        <div class="col-lg-6">
                                            <div class="list-group list-group-flush">
                                                  <div class="list-group-item">Marital Status: <br>
                                                       <span id="studentMaritalStatus"></span>
                                                  </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="list-group list-group-flush">
                                                  <div class="list-group-item">Religion: <br>
                                                       <span id="studentReligion"></span>
                                                  </div>
                                            </div>
                                        </div>
                                      </div>
                                  </div>
                              </div>
                              <div class="col-lg-6">
                                  <div class="list-group list-group-flush">
                                   <div class="row border-bottom">
                                        <div class="col-lg-6">
                                            <div class="list-group list-group-flush">
                                             <div class="list-group-item">Date of Birth: <br>
                                                  <span id="studentbirthDate"></span>
                                             </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="list-group list-group-flush">
                                             <div class="list-group-item">Gender: <br>
                                                  <span id="studentGender"></span>
                                             </div>
                                            </div>
                                        </div>
                                      </div>
                                      <div class="list-group-item">Contact Address:<br>
                                          <span id="studentContactAddress"></span>
                                      </div>
                                      <div class="row border-bottom">
                                        <div class="col-lg-6">
                                            <div class="list-group list-group-flush">
                                             <div class="list-group-item">Local Govt:<br>
                                                  <span id="studentLocalGovt"></span>
                                              </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="list-group list-group-flush">
                                             <div class="list-group-item">State of Origin:<br>
                                                  <span id="studentStateOfOrigin"></span>
                                              </div>
                                            </div>
                                        </div>
                                      </div>
                                      <div class="list-group-item">Nationality:<br>
                                          <span id="studentNationality"></span>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                      <!-- NEXT OF KIN -->
                      <div class="more-details mb-5">
                          <h5 class="modal-title text-danger">NEXT OF KIN'S INFORMATION</h5>
                          <hr>
                          <div class="row">
                              <div class="col-lg-6">
                                  <div class="list-group list-group-flush">
                                      <div class="list-group-item">Kin Name:<br>
                                          <span id="kinName"></span>
                                      </div>
                                      <div class="list-group-item">Kin Relationship:<br>
                                          <span id="kinRelationship"></span>
                                      </div>
                                      <div class="list-group-item">Kin Occupation:<br>
                                          <span id="kinOccupation"></span>
                                      </div>
                                  </div>
                              </div>
                              <div class="col-lg-6">
                                  <div class="list-group list-group-flush">
                                      <div class="list-group-item">Kin Phone:<br>
                                          <span id="kinPhone"></span>
                                      </div>
                                      <div class="list-group-item">Kin Email:<br>
                                          <span id="kinEmail"></span>
                                      </div>
                                      <div class="list-group-item">Kin Address:<br>
                                          <span id="kinAddress"></span>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                      <!-- Academic Information -->
                      <div class="more-details">
                          <h5 class="modal-title text-danger">ACADEMIC INFORMATION</h5>
                          <hr>
                          <div class="row">
                              <div class="col-lg-6">
                                  <div class="list-group list-group-flush">
                                      <div class="list-group-item">Matriculation Number:<br>
                                          <span id="matricNumber"></span>
                                      </div>
                                      <div class="list-group-item">Faculty:<br>
                                          <span id="faculty"></span>
                                      </div>
                                  </div>
                              </div>
                              <div class="col-lg-6">
                                  <div class="list-group list-group-flush">
                                      <div class="list-group-item">Admission Year:<br>
                                          <span id="admissionYear"></span>
                                      </div>
                                      <div class="list-group-item">Program Type<br>
                                          <span id="programType"></span>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-danger" data-bs-dismiss="modal" onclick="expelStudent(student)">Expel</button>
                  </div>
              </div>
          </div>
      </div>
      

     <!-- Font Awsome Link -->
     <script src="https://kit.fontawesome.com/2a49fbdbb8.js" crossorigin="anonymous"></script>
     <!-- Bootstrap Js -->
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
     <!-- AXIOS JS -->
     <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
     <script>
          let apiUrl = "/api/v1/auth/users";
          let datalist = document.querySelector('.datalist');
          document.addEventListener('DOMContentLoaded', function() {
               // Function to populate and show the modal
               function showStudentDetails(student) {
                    document.getElementById('studentFullname').textContent = `${student.firstName} ${student.lastName}`;
                    document.getElementById('studentPhoneNumber').textContent = student.phoneNum;
                    document.getElementById('studentEmailAddress').textContent = student.email;
                    document.getElementById('studentGender').textContent = student.genderType;
                    document.getElementById('studentMaritalStatus').textContent = student.maritalStatus;
                    document.getElementById('studentReligion').textContent = student.religion;
                    document.getElementById('studentContactAddress').textContent = student.address;
                    document.getElementById('studentLocalGovt').textContent = student.lgovOrigin;
                    document.getElementById('studentStateOfOrigin').textContent = student.stateOrigin;
                    document.getElementById('studentNationality').textContent = student.nationality;
                    document.getElementById('kinName').textContent = student.kinName;
                    document.getElementById('kinRelationship').textContent = student.kinRela;
                    document.getElementById('kinOccupation').textContent = student.kinOccup;
                    document.getElementById('kinAddress').textContent = student.kinAddress;
                    document.getElementById('kinPhone').textContent = student.kinTel;
                    document.getElementById('kinEmail').textContent = student.kinEmail;
                    document.getElementById('matricNumber').textContent = student.matricNumber;
                    document.getElementById('faculty').textContent = student.studyType;
                    document.getElementById('admissionYear').textContent = student.admissionYear;
                    document.getElementById('programType').textContent = student.programType;
                    document.getElementById('studentbirthDate').textContent = new Date(student.birthDate).toLocaleDateString();
                    document.getElementById('studentPhoto').src = student.photo;                   
                   // Show the modal
                   let modal = new bootstrap.Modal(document.getElementById('studentDetailsModal'));
                   modal.show();
               }
           
               // Fetch data and populate the table
               axios.get(apiUrl)
               .then((response) => {
                   let data = response.data;
                   console.log(data)
                   data.forEach(student => {
                       let row = document.createElement('tr');
                       row.innerHTML = `
                           <td><img src="${student.photo}" width="50px" height="50px"></td>
                           <td>${student.firstName} ${student.lastName}</td>
                           <td>${student.email}</td>
                           <td>${student.matricNumber}</td>
                           <td>${student.studyType}</td>
                           <td>${student.programType}</td>
                           <td>${new Date(student.birthDate).toLocaleDateString()}</td>
                           <td>${student.admissionYear}</td>
                       `;
                       row.addEventListener('click', () => showStudentDetails(student));
                       datalist.appendChild(row);
                   });
               })
               .catch((error) => {
                   console.log(error);
               });
           });
           
           // Function to expel (delete) a student
          function expelStudent(student) {
               axios.delete(`${apiUrl}/${student}`)
               .then((response) => {
                    alert('Student expelled successfully!');
                    location.reload();
               })
               .catch((error) => {
               console.log(error);
               });
          }

     </script>
     <script>
           let searchInput = document.querySelector('#inputs');
           let tableBody = document.querySelector('.datalist');
           let tableRows = tableBody.getElementsByTagName('tr');
          
           searchInput.addEventListener('input', displayResults);

           function displayResults() {
               let searchTerm = searchInput.value.toLowerCase();

               for (let row of tableRows) {
                    let cells = row.getElementsByTagName('td');
                    let match = false;
                    for (let cell of cells) {
                         if (cell.textContent.toLowerCase().includes(searchTerm)) {
                              match = true;
                              break;
                         }
                    }
                    row.style.display = match ? '' : 'none';
               }
           }
     </script>
     <script>
          axios.get("/api/v1/faculty/allfaculty")
          .then((response) => {
          let data = response.data.data;
          data.forEach(item => {
               let option = document.createElement("option");
               option.innerHTML = item.name;
               studyType.appendChild(option);
          });
          })
          .catch((error) => {
          console.error("Error fetching data:", error);
          });
     </script>
     <script>
          let filterModal = document.querySelector("#filterModal");

          document.querySelector(".btn-close").addEventListener("click", () => {
               let extended = filterModal.style.display === "none";
               filterModal.style.display = extended ? "none" : "block";
          });
          document.querySelector(".btnClose").addEventListener("click", () => {
               let extended = filterModal.style.display === "none";
               filterModal.style.display = extended ? "none" : "block";
          });

          // Filter functionality
          document.querySelector('#applyFilters').addEventListener('click', () => {
          let facultyFilter = document.querySelector('#facultyFilter').value.toLowerCase();
          let admissionTypeFilter = document.querySelector('#admissionTypeFilter').value.toLowerCase();
          let yearFilter = document.querySelector('#yearFilter').value;

          let tableBody = document.querySelector('.datalist');
          let tableRows = tableBody.getElementsByTagName('tr');

          for (let row of tableRows) {
               let cells = row.getElementsByTagName('td');
               let faculty = cells[4].textContent.toLowerCase();
               let admissionType = cells[5].textContent.toLowerCase();
               let year = cells[7].textContent;

               let matchFaculty = facultyFilter === "" || faculty === facultyFilter;
               let matchAdmissionType = admissionTypeFilter === "" || admissionType === admissionTypeFilter;
               let matchYear = yearFilter === "" || year === yearFilter;

               row.style.display = matchFaculty && matchAdmissionType && matchYear ? '' : 'none';
          }
          // Close the modal after applying filters
          let filterModal = bootstrap.Modal.getInstance(document.getElementById('filterModal'));
          filterModal.hide();
          });

     </script>
     <script>
          // Refresh button functionality
          document.querySelector('.refresh').addEventListener('click', () => {
               window.location.reload();
          });
     </script>
     <script>
document.querySelector('#applyFilters').addEventListener('click', () => {
    let facultyFilter = document.querySelector('#facultyFilter').value.toLowerCase();
    let admissionTypeFilter = document.querySelector('#admissionTypeFilter').value.toLowerCase();
    let yearFilter = document.querySelector('#yearFilter').value;

    let tableBody = document.querySelector('.datalist');
    let tableRows = tableBody.getElementsByTagName('tr');

    for (let row of tableRows) {
        let cells = row.getElementsByTagName('td');
        let faculty = cells[4].textContent.toLowerCase();
        let admissionType = cells[5].textContent.toLowerCase();
        let year = cells[7].textContent;

        let matchFaculty = facultyFilter === "" || faculty === facultyFilter;
        let matchAdmissionType = admissionTypeFilter === "" || admissionType === admissionTypeFilter;
        let matchYear = yearFilter === "" || year === yearFilter;

        row.style.display = matchFaculty && matchAdmissionType && matchYear ? '' : 'none';
    }
    // Close the modal after applying filters
    let filterModal = bootstrap.Modal.getInstance(document.getElementById('filterModal'));
    filterModal.hide();
});

document.querySelector('.refresh').addEventListener('click', () => {
    window.location.reload();
});

const studyType = document.querySelector("#facultyFilter");
axios.get("/api/v1/faculty/allfaculty")
.then((response) => {
    let data = response.data.data;
    data.forEach(item => {
        let option = document.createElement("option");
        option.innerHTML = item.name;
        studyType.appendChild(option);
    });
})
.catch((error) => {
    console.error("Error fetching data:", error);
});



     </script>

</body>
</html>