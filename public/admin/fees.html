<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <!-- Bootstrap -->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
     <link rel="stylesheet" href="../offlines/bootstrap.min.css">
     <!-- Icon -->
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
     <link rel="stylesheet" href="../offlines/fontawesome-free-6.4.2-web/css/all.css">
     <link rel="stylesheet" href="../offlines/tabler-icons/webfont/tabler-icons.min.css">

     <link rel="stylesheet" href="../student/dashboard.css">
     <link rel="stylesheet" href="../responsiveness.css">
     <link rel="stylesheet" href="../styles.css">
     <link rel="stylesheet" href="loading.css">

     <link rel="icon" href="../images/single.png">
     <title>Tution Fees List</title>
</head>
<body style="position: relative;"  class="collapsed general">
     <!-- Loading display -->
     <!-- <div id="loading" class="loading">
          <div class="loader">
               <div class="box1"></div>
               <div class="box2"></div>
               <div class="box3"></div>
          </div>
     </div> -->

     <main id="content" class="main-content hidde row general">
     
          <div class="col-2 p-0" id="side">
               <nav class="sidebar">
                    <div class="sidebar-top-wrapper">
                         <div class="sidebar-top mx-auto">
                              <a href="#" class="logo_wrapper">
                                   <img src="../images/multiple.png" alt="logo" class="logo-small logo-small1">
                                   <img src="../images/single.png" alt="logo" class="logo-small logo-small2">
                              </a>
                         </div>
                         <button class="expand-btn" type="button"><i class="fa fa-expand"></i></button>
                    </div>
                    <div class="sidebar-links-wrapper">
                         <div class="sidebar-links">
                              <ul>
                                   <li>
                                        <a href="index" class="main-item" title="Dashboard">
                                             <i class="fa-solid fa-tachograph-digital"></i>
                                             <span class="link hide">Overview</span>
                                        </a>
                                   </li>
                                   <li>
                                        <a href="allStudents" title="All Students" class="main-item">
                                             <i class="fa-solid fa-building-columns"></i>
                                             <span class="link hide">All Students</span>
                                        </a>
                                   </li>
                                   <li>
                                        <a href="CreateFaculty" title="Create Faculty" class="main-item">
                                             <i class="fa fa-clipboard"></i>
                                             <span class="link hide">Create Faculty</span>
                                        </a>
                                   </li>
                                   <li>
                                        <a href="fees" title="Tution Fees" class="main-item active">
                                             <i class="fa-solid fa-money-check-dollar"></i>
                                             <span class="link hide">Tution Fees</span>
                                        </a>
                                   </li>
                                   <li>
                                        <a href="event" title="Event" class="main-item">
                                             <i class="fa fa-calendar"></i>
                                             <span class="link hide">Event</span>
                                        </a>
                                   </li>
                              </ul>
                         </div>
                    </div>
                    <div class="sidebar_bottom">
                         <div class="sidebar_profile">
                              <div class="avatar_wrapper">
                                   <img src="../images/single.png" alt="avatar" class="avatar bg-light">
                              </div>
                              <div class="avatar_name hide">
                                   <div class="user-name">Administrator</div>
                                   <div class="email">admin@mail.com</div>
                              </div>
                         </div>
                         <!-- Logout icon -->
                         <a title="Logout" class="logout tooltips main-item" onclick="logout()">
                              <i class="fa fa-sign-out-alt"></i>
                              <span class="expand-icon">Logout</span>
                         </a>
                    </div>
               </nav>
          </div>

          <div class="col-10" id="main">
               <section class="main-content ms-auto pb-5">
                    <div class="row align-items-center">
                         <div class="col-12">
                              <div class="in-new-prod-cont p-3">
                                   <h4 class="p-0 m-0">Paid Students</h4>
                              </div>
                         </div>

                         <!-- search bar and filter button -->
                         <div class="row align-items-center my-3 gap-3 gap-md-0 justify-content-between">
                              <div class="col-md-6 col-12">
                                   <div class="input-group">
                                        <input type="text" class="form-control" id="inputs" placeholder="Search Student">
                                        <button class="btn btn-outline-secondary" type="button" id="button-addon2"><i class="fa fa-search"></i></button>
                                   </div>
                              </div>
                              <div class="col-lg-4 col-md-6 col-12 d-flex gap-3 align-items-md-end align-items-center justify-content-md-end justify-content-center">
                                   <button class="btn btn-primary refresh"><i class="fa-solid me-2 fa-arrows-rotate"></i> Refresh</button>
                                   <button class="btn btn-primary filterBtn" data-bs-toggle="modal" data-bs-target="#filterModal"><i class="fa me-2 fa-filter"></i> Filter</button>
                              </div>
                         </div>
                         
                         <!-- table -->
                         <div class="row my-3">
                              <div class="col-12">
                                   <div class="table-responsive">
                                        <table class="table">
                                             <thead>
                                                  <tr>
                                                       <th scope="col">Matric Number</th>
                                                       <th scope="col">Fullname</th>
                                                       <th scope="col">Faculty</th>
                                                       <th scope="col">Admission Type</th>
                                                       <th scope="col">Payment Type</th>
                                                       <th scope="col">Transaction Refrence</th>
                                                       <th scope="col">Year paid for</th>
                                                  </tr>
                                             </thead>
                                             <tbody id="datalist">
                                                  <!-- Data will be appended here -->
                                             </tbody>
                                        </table>
                                   </div>
                              </div>
                         </div>

                         <!-- Filter Modal -->
                         <div class="modal fade " id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
                              <div class="modal-dialog bg-dark text-light">
                              <div class="modal-content">
                                   <div class="modal-header">
                                             <h5 class="modal-title" id="filterModalLabel">Filter Options</h5>
                                             <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                   </div>
                                   <div class="modal-body">
                                             <div class="mb-3">
                                                  <label for="facultyFilter" class="form-label">Faculty</label>
                                                  <select name="facultyFilter" class="px-2 form-control" id="facultyFilter">
                                                  <option value="" selected disabled>Select Faculty</option>
                                                  <option value="">All</option>
                                                  </select>
                                             </div>
                                             <!-- Addmision Type -->
                                             <div class="mb-3">
                                                  <label for="admissionTypeFilter" class="form-label">Admission Type</label>
                                                  <select name="admissionTypeFilter" class="px-2 form-control" id="admissionTypeFilter">
                                                       <option value="" selected disabled>Select Program Type</option>
                                                       <option value="">All</option>
                                                       <option value="UnderGraduate">UnderGraduate</option>
                                                       <option value="PostGraduate">PostGraduate</option>
                                                       <option value="PartTime">PartTime</option>
                                                       <option value="Open Distance Learning">Open Distance Learning</option>
                                                       <option value="Pre Degree Program">Pre Degree Program</option>
                                                       <option value="JUPEB Program">JUPEB Program</option>
                                                  </select>
                                             </div>
                                             <!-- Payment Type -->
                                             <div class="mb-3">
                                             <label for="paymentTypeFilter" class="form-label">Payment Type</label>
                                             <select name="paymentTypeFilter" class="px-2 form-control" id="paymentTypeFilter">
                                                  <option value="" selected disabled>Select Payment Type</option>
                                                  <option value="">All</option>
                                                  <option value="Full Payment">Full Payment</option>
                                                  <option value="Part Payment">Part Payment</option>
                                             </select>
                                             </div>
                                             <!-- Status -->
                                             <div class="mb-3">
                                                  <label for="yearFilter" class="form-label">Year paid for</label>
                                                  <select id="yearFilter" class="form-select">
                                                  <option value="">All</option>
                                                  <option value="First Year">First Year</option>
                                                  <option value="Second Year">Second Year</option>
                                                  <option value="Third Year">Third Year</option>
                                                  <option value="Fourth Year">Fourth Year</option>
                                                  <option value="Fifth Year">Fifth Year</option>
                                                  </select>
                                             </div>
                                   </div>
                                   <div class="modal-footer">
                                             <!-- reset button -->
                                             <button type="button" class="btn btn-danger" id="resetFilters">Reset</button>
                                             <button type="button" class="btn btn-secondary btnClose" data-bs-dismiss="modal">Close</button>
                                             <button type="button" class="btn btn-primary" id="applyFilters">Apply Filters</button>
                                   </div>
                              </div>
                              </div>
                         </div>
                    </div>
               </section>
          </div>

     </main>

    <script src="loading.js"></script>
    <script src="../student/sidebar.js"></script>
    <script src="../student/dashboard.js"></script>
     <!-- Font Awsome Link -->
     <script src="https://kit.fontawesome.com/2a49fbdbb8.js" crossorigin="anonymous"></script>
     <!-- Bootstrap Js -->
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
     <script src="../bootstrap-5.3.3-dist/js/bootstrap.bundle.min.js"></script>
     <!-- AXIOS JS -->
     <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
     <script>
          document.addEventListener('DOMContentLoaded', function() {
               axios.get("/api/v1/auth/users")
                   .then((response) => {
                       let users = response.data;
                       axios.get("/api/v1/transaction/getAll")
                           .then((response) => {
                               let transactions = response.data.transactions;
                               appendUserDetails(transactions, users);
                           })
                           .catch((error) => {
                               console.log(error);
                           });
                   })
                   .catch((error) => {
                       console.log(error);
                   });
           });
   
           function appendUserDetails(transactions, users) {
               const dataList = document.getElementById('datalist');
               dataList.innerHTML = '';
               let year = '';
               transactions.forEach(transaction => {
                   const user = users.find(user => user._id === transaction.userId);
                   if (user) {
                         if (transaction.year == 'firstYear'){
                              year = 'First Year';
                         } else if (transaction.year == 'secondYear'){
                              year = 'Second Year';
                         } 
                         else if (transaction.year == 'thirdYear'){
                              year = 'Third Year';
                         }
                         else if (transaction.year == 'fourthYear'){
                              year = 'Fourth Year';
                         }
                         else if (transaction.year == 'fifthYear'){
                              year = 'Fifth Year';
                         }
                       const row = document.createElement('tr');
                       row.innerHTML = `
                           <td>${user.matricNumber}</td>
                           <td>${user.firstName} ${user.lastName}</td>
                           <td>${transaction.studyType}</td>
                           <td>${transaction.transType}</td>
                           <td>${transaction.transRef}</td>
                           <td>${transaction.transStatus}</td>
                           <td>${year}</td>
                       `;
                       dataList.appendChild(row);
                   }
               });
   
               // Initialize tableRows after data is appended
               tableRows = document.querySelectorAll('tbody tr');
           }
   
           // Search functionality
           let searchInput = document.querySelector('#inputs');
           let tableRows;
   
           searchInput.addEventListener('input', displayResults);
   
           function displayResults() {
               let searchTerm = searchInput.value.toLowerCase();
               tableRows.forEach(row => {
                   let cells = row.getElementsByTagName('td');
                   let match = false;
                   for (let cell of cells) {
                       if (cell.textContent.toLowerCase().includes(searchTerm)) {
                           match = true;
                           break;
                       }
                   }
                   row.style.display = match ? '' : 'none';
               });
           }
   
           // Filter functionality
           let filterModal = document.querySelector("#filterModal");
           // Faculty filter option fetch
           const studyType = document.querySelector("#facultyFilter");
           axios.get("/api/v1/faculty/allfaculty")
               .then((response) => {
                   let data = response.data.data;
                   data.forEach(item => {
                       let option = document.createElement("option");
                       option.innerHTML = item.name;
                       studyType.appendChild(option);
                   });
               })
               .catch((error) => {
                   console.error("Error fetching data:", error);
               });
   
           document.querySelector('#applyFilters').addEventListener('click', applyFilters);
           document.querySelector('#resetFilters').addEventListener('click', resetFilters);
   
           function applyFilters() {
               let selectedFaculty = document.querySelector('#facultyFilter').value.toLowerCase();
               let selectedAdmissionType = document.querySelector('#admissionTypeFilter').value.toLowerCase();
               let selectedYear = document.querySelector('#yearFilter').value.toLowerCase();
               let paymentType = document.querySelector('#paymentTypeFilter').value.toLowerCase();
           
               tableRows.forEach(row => {
                   let cells = row.getElementsByTagName('td');
                   let facultyMatch = selectedFaculty === '' || cells[2].textContent.toLowerCase().includes(selectedFaculty);
                   let admissionTypeMatch = selectedAdmissionType === '' || cells[3].textContent.toLowerCase().includes(selectedAdmissionType);
                   let yearMatch = selectedYear === '' || cells[6].textContent.toLowerCase().includes(selectedYear);
                   let paymentTypeMatch = paymentType === '' || cells[7].textContent.toLowerCase().includes(paymentType);
           
                   row.style.display = facultyMatch && admissionTypeMatch && yearMatch && paymentTypeMatch ? '' : 'none';
               });
           }           
   
           function resetFilters() {
               document.querySelector('#facultyFilter').value = "";
               document.querySelector('#admissionTypeFilter').value = "";
               document.querySelector('#yearFilter').value = "";
               document.querySelector('#paymentTypeFilter').value = "";
   
               tableRows.forEach(row => {
                   row.style.display = '';
               });
           }    
     </script>
</body>
</html>